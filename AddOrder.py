# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'AddOrder.ui'
#
# Created by: PyQt5 UI code generator 5.15.9
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.

import psycopg2
from PyQt5 import QtCore, QtGui, QtWidgets
from PyQt5.QtWidgets import QMessageBox
from datetime import date

class Ui_AddOder(object):

    def __init__(self):
        # PostgreSQL connection        
        self.conn = psycopg2.connect(host="aws-0-ap-southeast-1.pooler.supabase.com", dbname="postgres", user="postgres.oxzprkjuxnjgnfihweyj", 
                                     password="Milliondollarbaby123", port=6543)
        self.cur = self.conn.cursor()

    def save_data(self):
        # Get data from UI elements
        cus_fname = self.lineEdit.text().strip()
        cus_lname = self.lineEdit_5.text().strip()
        cus_email = self.lineEdit_2.text().strip()
        cus_phone = self.lineEdit_3.text().strip()
        cus_address = self.lineEdit_14.text().strip()
        order_date = date.today()
        due_date = self.lineEdit_13.text().strip()
        product_name = self.comboBox.currentText().strip()
        quantity = self.lineEdit_11.text().strip()
        total_amount = self.lineEdit_15.text().strip()

        # Validate input data
        if not (cus_fname and cus_lname and cus_email and cus_phone and cus_address and due_date and product_name and quantity and total_amount):
            self.show_message("Error", "Please fill all the fields.")
            return

        try:
            # Check if product exists and get its ID
            sql_get_product_id = "SELECT PROD_ID FROM PRODUCT WHERE PROD_NAME = %s"
            self.cur.execute(sql_get_product_id, (product_name,))
            product_id_result = self.cur.fetchone()

            if product_id_result is None:
                self.show_message("Error", "Selected product does not exist.")
                return

            product_id = product_id_result[0]

            # Insert into CUSTOMER table
            sql_customer = """
            INSERT INTO CUSTOMER (CUS_FNAME, CUS_LNAME, CUS_EMAIL, CUS_PHONE, CUS_ADDRESS) 
            VALUES (%s, %s, %s, %s, %s) RETURNING CUS_ID
            """
            self.cur.execute(sql_customer, (cus_fname, cus_lname, cus_email, cus_phone, cus_address))
            customer_id = self.cur.fetchone()[0]  # Get the newly inserted customer ID

            # Insert into ORDERS table
            sql_orders = """
            INSERT INTO ORDERS (CUS_ID, ORDER_DATE, DUE_DATE, PROD_ID, QUANTITY, TOTAL_AMOUNT) 
            VALUES (%s, %s, %s, %s, %s, %s)
            """
            self.cur.execute(sql_orders, (customer_id, order_date, due_date, product_id, quantity, total_amount))

            self.conn.commit()
            self.show_message("Success", "Data saved successfully.")
        except psycopg2.Error as e:
            self.conn.rollback()  # Roll back transaction on error
            error_message = f"Error saving data: {e.pgcode} - {e.pgerror}"
            self.show_message("Error", error_message) 

    def show_message(self, title, message):
        msg = QMessageBox()
        msg.setWindowTitle(title)
        msg.setText(message)
        msg.setIcon(QMessageBox.Information)
        msg.exec_()

    def setupUi(self, AddOder):
        AddOder.setObjectName("AddOder")
        AddOder.resize(641, 481)
        AddOder.setFixedSize(640, 480)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Fixed)
        AddOder.setSizePolicy(sizePolicy)
        self.frame = QtWidgets.QFrame(AddOder)
        self.frame.setEnabled(True)
        self.frame.setGeometry(QtCore.QRect(0, 0, 641, 481))
        self.frame.setStyleSheet("QFrame{\n"
"    background-color: rgb(255, 255, 255);\n"
"}\n"
"QLabel#AddOrder{\n"
"    font-size: 25px;\n"
"}\n"
"QLineEdit{\n"
"    width: 200px;\n"
"}\n"
"QPushButton#Cancel{    \n"
"    color: rgb(255, 255, 255);\n"
"    background-color: #202020;\n"
"}\n"
"QPushButton{    \n"
"    color: rgb(255, 255, 255);\n"
"    background-color: #CD2E2E;\n"
"}")
        self.frame.setFrameShape(QtWidgets.QFrame.StyledPanel)
        self.frame.setFrameShadow(QtWidgets.QFrame.Raised)
        self.frame.setObjectName("frame")
        self.AddOrder = QtWidgets.QLabel(self.frame)
        self.AddOrder.setGeometry(QtCore.QRect(240, 10, 126, 26))
        self.AddOrder.setObjectName("AddOrder")
        self.Cancel = QtWidgets.QPushButton(self.frame)
        self.Cancel.clicked.connect(AddOder.close)
        self.Cancel.setGeometry(QtCore.QRect(360, 420, 96, 31))
        self.Cancel.setCursor(QtGui.QCursor(QtCore.Qt.PointingHandCursor))
        self.Cancel.setObjectName("Cancel")
        self.AddOrder_3 = QtWidgets.QPushButton(self.frame)
        self.AddOrder_3.clicked.connect(self.save_data)
        self.AddOrder_3.clicked.connect(AddOder.close)
        self.AddOrder_3.setGeometry(QtCore.QRect(470, 420, 91, 31))
        self.AddOrder_3.setCursor(QtGui.QCursor(QtCore.Qt.PointingHandCursor))
        self.AddOrder_3.setObjectName("AddOrder_3")
        self.frame_2 = QtWidgets.QFrame(self.frame)
        self.frame_2.setGeometry(QtCore.QRect(50, 50, 521, 361))
        self.frame_2.setFrameShape(QtWidgets.QFrame.NoFrame)
        self.frame_2.setFrameShadow(QtWidgets.QFrame.Sunken)
        self.frame_2.setLineWidth(1)
        self.frame_2.setObjectName("frame_2")
        self.lineEdit_14 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_14.setGeometry(QtCore.QRect(30, 230, 113, 20))
        self.lineEdit_14.setObjectName("lineEdit_14")
        self.label_14 = QtWidgets.QLabel(self.frame_2)
        self.label_14.setGeometry(QtCore.QRect(30, 210, 76, 16))
        self.label_14.setObjectName("label_14")
        self.lineEdit_4 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_4.setEnabled(False)
        self.lineEdit_4.setGeometry(QtCore.QRect(30, 280, 113, 20))
        self.lineEdit_4.setObjectName("lineEdit_4")
        self.label_4 = QtWidgets.QLabel(self.frame_2)
        self.label_4.setGeometry(QtCore.QRect(30, 260, 76, 16))
        self.label_4.setObjectName("label_4")
        self.lineEdit_10 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_10.setGeometry(QtCore.QRect(330, 280, 41, 20))
        self.lineEdit_10.setObjectName("lineEdit_10")
        self.label_11 = QtWidgets.QLabel(self.frame_2)
        self.label_11.setGeometry(QtCore.QRect(330, 260, 47, 14))
        self.label_11.setObjectName("label_11")
        self.lineEdit_11 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_11.setGeometry(QtCore.QRect(330, 230, 113, 20))
        self.lineEdit_11.setObjectName("lineEdit_11")
        self.label_12 = QtWidgets.QLabel(self.frame_2)
        self.label_12.setGeometry(QtCore.QRect(330, 210, 47, 14))
        self.label_12.setObjectName("label_12")
        self.label_13 = QtWidgets.QLabel(self.frame_2)
        self.label_13.setGeometry(QtCore.QRect(330, 110, 81, 16))
        self.label_13.setObjectName("label_13")
        self.label_10 = QtWidgets.QLabel(self.frame_2)
        self.label_10.setGeometry(QtCore.QRect(330, 60, 47, 14))
        self.label_10.setObjectName("label_10")
        self.lineEdit_13 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_13.setGeometry(QtCore.QRect(330, 80, 113, 20))
        self.lineEdit_13.setObjectName("lineEdit_13")
        self.comboBox = QtWidgets.QComboBox(self.frame_2)
        self.comboBox.setGeometry(QtCore.QRect(330, 130, 151, 22))
        self.comboBox.setObjectName("comboBox")
        self.comboBox.addItem("")
        self.comboBox.addItem("")
        self.comboBox.addItem("")
        self.comboBox.addItem("")
        self.lineEdit_m = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_m.setGeometry(QtCore.QRect(330, 180, 151, 22))
        self.lineEdit_m.setObjectName("lineEdit_m")
        self.label_15 = QtWidgets.QLabel(self.frame_2)
        self.label_15.setGeometry(QtCore.QRect(330, 160, 81, 16))
        self.label_15.setObjectName("label_15")
        self.lineEdit_3 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_3.setGeometry(QtCore.QRect(30, 180, 113, 20))
        self.lineEdit_3.setObjectName("lineEdit_3")
        self.label_3 = QtWidgets.QLabel(self.frame_2)
        self.label_3.setGeometry(QtCore.QRect(30, 160, 81, 16))
        self.label_3.setObjectName("label_3")
        self.lineEdit_2 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_2.setGeometry(QtCore.QRect(30, 130, 113, 20))
        self.lineEdit_2.setObjectName("lineEdit_2")
        self.lineEdit = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit.setGeometry(QtCore.QRect(30, 30, 111, 20))
        self.lineEdit.setMaxLength(300)
        self.lineEdit.setObjectName("lineEdit")
        self.label = QtWidgets.QLabel(self.frame_2)
        self.label.setGeometry(QtCore.QRect(30, 10, 101, 16))
        self.label.setObjectName("label")
        self.lineEdit_5 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_5.setGeometry(QtCore.QRect(30, 80, 111, 20))
        self.lineEdit_5.setMaxLength(300)
        self.lineEdit_5.setObjectName("lineEdit_5")
        self.label_5 = QtWidgets.QLabel(self.frame_2)
        self.label_5.setGeometry(QtCore.QRect(30, 60, 101, 16))
        self.label_5.setObjectName("label_5")
        self.label_2 = QtWidgets.QLabel(self.frame_2)
        self.label_2.setGeometry(QtCore.QRect(30, 110, 76, 16))
        self.label_2.setObjectName("label_2")
        self.label_6 = QtWidgets.QLabel(self.frame_2)
        self.label_6.setGeometry(QtCore.QRect(30, 310, 76, 16))
        self.label_6.setObjectName("label_6")
        self.lineEdit_15 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_15.setGeometry(QtCore.QRect(30, 330, 113, 20))
        self.lineEdit_15.setObjectName("lineEdit_15")
        self.lineEdit_12 = QtWidgets.QLineEdit(self.frame_2)
        self.lineEdit_12.setGeometry(QtCore.QRect(400, 280, 41, 20))
        self.lineEdit_12.setObjectName("lineEdit_12")
        self.textEdit = QtWidgets.QTextEdit(self.frame_2)
        self.textEdit.setEnabled(True)
        self.textEdit.setGeometry(QtCore.QRect(378, 280, 21, 41))
        self.textEdit.setAcceptDrops(False)
        self.textEdit.setFrameShape(QtWidgets.QFrame.NoFrame)
        self.textEdit.setAcceptRichText(False)
        self.textEdit.setTextInteractionFlags(QtCore.Qt.TextSelectableByMouse)
        self.textEdit.setObjectName("textEdit")
        self.comboBox_3 = QtWidgets.QComboBox(self.frame_2)
        self.comboBox_3.setGeometry(QtCore.QRect(450, 280, 61, 22))
        self.comboBox_3.setObjectName("comboBox_3")
        self.comboBox_3.addItem("")
        self.comboBox_3.addItem("")
        self.comboBox_3.addItem("")
        self.comboBox_3.addItem("")
        self.comboBox_3.addItem("")
        self.textEdit.raise_()
        self.lineEdit_14.raise_()
        self.label_14.raise_()
        self.lineEdit_4.raise_()
        self.label_4.raise_()
        self.lineEdit_10.raise_()
        self.label_11.raise_()
        self.lineEdit_11.raise_()
        self.label_12.raise_()
        self.label_13.raise_()
        self.label_10.raise_()
        self.lineEdit_13.raise_()
        self.comboBox.raise_()
        self.lineEdit_m.raise_()
        self.label_15.raise_()
        self.lineEdit_3.raise_()
        self.label_3.raise_()
        self.lineEdit_2.raise_()
        self.lineEdit.raise_()
        self.label.raise_()
        self.lineEdit_5.raise_()
        self.label_5.raise_()
        self.label_2.raise_()
        self.label_6.raise_()
        self.lineEdit_15.raise_()
        self.lineEdit_12.raise_()
        self.comboBox_3.raise_()
        self.frame_2.raise_()
        self.AddOrder.raise_()
        self.Cancel.raise_()
        self.AddOrder_3.raise_()

        self.retranslateUi(AddOder)
        QtCore.QMetaObject.connectSlotsByName(AddOder)

    def retranslateUi(self, AddOder):
        _translate = QtCore.QCoreApplication.translate
        AddOder.setWindowTitle(_translate("AddOder", "Dialog"))
        self.AddOrder.setText(_translate("AddOder", "Add Order"))
        self.Cancel.setText(_translate("AddOder", "Cancel"))
        self.AddOrder_3.setText(_translate("AddOder", "Add Order"))
        self.label_14.setText(_translate("AddOder", "Address"))
        self.label_4.setText(_translate("AddOder", "Price"))
        self.label_11.setText(_translate("AddOder", "Size"))
        self.label_12.setText(_translate("AddOder", "Quantity"))
        self.label_13.setText(_translate("AddOder", "Category"))
        self.label_10.setText(_translate("AddOder", "Due Date"))
        self.comboBox.setItemText(0, _translate("AddOder", "Large Format Tarpaulin"))
        self.comboBox.setItemText(1, _translate("AddOder", "Vinyl Sticker Printing"))
        self.comboBox.setItemText(2, _translate("AddOder", "Laser Printing Stickers"))
        self.comboBox.setItemText(3, _translate("AddOder", "T-shirt Printing"))
        self.label_15.setText(_translate("AddOder", "Type of Product"))
        self.label_3.setText(_translate("AddOder", "Contact Number"))
        self.label.setText(_translate("AddOder", "Customer First Name"))
        self.label_5.setText(_translate("AddOder", "Customer Last Name"))
        self.label_2.setText(_translate("AddOder", "Email Address"))
        self.label_6.setText(_translate("AddOder", "Total Amount"))
        self.textEdit.setHtml(_translate("AddOder", "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0//EN\" \"http://www.w3.org/TR/REC-html40/strict.dtd\">\n"
"<html><head><meta name=\"qrichtext\" content=\"1\" /><style type=\"text/css\">\n"
"p, li { white-space: pre-wrap; }\n"
"</style></head><body style=\" font-family:\'MS Shell Dlg 2\'; font-size:8.25pt; font-weight:400; font-style:normal;\">\n"
"<p style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-weight:600;\">X</span></p></body></html>"))
        self.comboBox_3.setItemText(0, _translate("AddOder", "ft"))
        self.comboBox_3.setItemText(1, _translate("AddOder", "inches"))
        self.comboBox_3.setItemText(2, _translate("AddOder", "small"))
        self.comboBox_3.setItemText(3, _translate("AddOder", "medium"))
        self.comboBox_3.setItemText(4, _translate("AddOder", "large"))


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    AddOder = QtWidgets.QDialog()
    ui = Ui_AddOder()
    ui.setupUi(AddOder)
    AddOder.show()
    sys.exit(app.exec_())
